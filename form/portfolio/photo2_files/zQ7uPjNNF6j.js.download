;/*FB_PKG_DELIM*/

__d("LSCleanupSession",["LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][cleanupSession] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.i64.eq(a[1],c.i64.cast([0,0]))?d[2]=c.i64.cast([0,21]):(c.i64.eq(a[1],c.i64.cast([0,1]))?d[10]=c.i64.cast([0,20]):d[10]=c.i64.cast([0,20]),d[2]=d[10]),c.filter(c.db.table(258).fetch(),function(b){return(b.initiatorId===a[0]||b.responderId===a[0])&&c.i64.eq(b.clientType,a[2])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.filter(c.db.table(258).fetch(),function(b){return c.i64.eq(b.clientType,a[2])}).next().then(function(f,h){var e=f.done;f=f.value;return e?c.db.table(258).add({sessionId:c.i64.cast([-1,4294967295]),responderId:a[0],initiatorId:a[0],messageType:d[2],clientType:a[2]}):(h=f.item,c.sequence([function(a){return d[14]=h.sessionId,c.forEach(c.db.table(258).fetch([[[d[14]]]]),function(a){var b=a.update;a.item;return b({messageType:d[2]})})},function(e){return d[11]=new c.Map(),d[11].set("session_id",d[14]),d[11].set("responder_id",h.responderId),d[11].set("initiator_id",h.initiatorId),d[11].set("message_payload",h.messagePayload),d[11].set("pake_secret",h.pakeSecret),d[11].set("sender_id",a[0]),d[11].set("message_type",d[2]),d[11].set("client_type",a[2]),d[12]=c.toJSON(d[11]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"PakeMessages",c.i64.cast([0,717]),d[12],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[13]=a[0],a})}]))}):(f=e.item,d[11]=f.sessionId,d[10]=f.messageType,c.i64.eq(d[10],c.i64.cast([0,15]))||c.i64.eq(d[10],c.i64.cast([0,21]))||c.i64.eq(d[10],c.i64.cast([0,20]))?c.resolve(0):c.sequence([function(a){return c.forEach(c.db.table(258).fetch([[[d[11]]]]),function(a){var b=a.update;a.item;return b({messageType:d[2]})})},function(e){return d[12]=new c.Map(),d[12].set("session_id",d[11]),d[12].set("responder_id",f.responderId),d[12].set("initiator_id",f.initiatorId),d[12].set("message_payload",f.messagePayload),d[12].set("pake_secret",f.pakeSecret),d[12].set("sender_id",a[0]),d[12].set("message_type",d[2]),d[12].set("client_type",a[2]),d[13]=c.toJSON(d[12]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"PakeMessages",c.i64.cast([0,717]),d[13],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[14]=a[0],a})}]))})},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][cleanupSession] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"cleanupSession",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSCleanupSessionStoredProcedure",["LSCleanupSession","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.deviceId;d[1]=b.cleanupReason;d[2]=b.clientType;return c("LSCleanupSession").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("CleanupPakeSession",["LSCleanupSessionStoredProcedure","LSFactory","LSIntEnum","MAWOneTimeCodeGating","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var e=a.cleanupReason,g=a.clientType,j=a.deviceId;a=a.storage;return!d("MAWOneTimeCodeGating").isOneTimeCodeEnabled()?(i||(i=b("Promise"))).resolve():a.runInTransaction(function(a){return c("LSCleanupSessionStoredProcedure")(c("LSFactory")(a),{cleanupReason:(h||(h=d("LSIntEnum"))).ofNumber(e),clientType:h.ofNumber(g),deviceId:j})},"readwrite",void 0,void 0,f.id+":41")}g["default"]=a}),98);
__d("MWPakeQPLEvents",["qpl"],(function(a,b,c,d,e,f,g){"use strict";a=c("qpl")._(231349365,"1751");g.pakeInitiatorQplEvent=a}),98);
__d("PAKEMessageQplLoggingAction",[],(function(a,b,c,d,e,f){a=Object.freeze({ADD_MARKER:0,END_SUCCESS:1,END_FAILURE:2,ADD_ERROR_ANNOTATION:3});f["default"]=a}),66);
__d("LSQplInteractionHelper.nop",["FBLogger","I64","MWPakeQPLEvents","PAKEMessageQplLoggingAction","Promise","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f,g,j){a=(i||(i=d("I64"))).to_int32(g);switch(a){case c("PAKEMessageQplLoggingAction").ADD_MARKER:f==null?c("FBLogger")("labyrinth_web").mustfix("PAKE: markerName is null when adding DS PAKE marker."):c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,f);break;case c("PAKEMessageQplLoggingAction").END_FAILURE:f==null?c("FBLogger")("labyrinth_web").mustfix("PAKE: markerName is null when adding failure DS PAKE marker."):c("QPLUserFlow").endFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,f);break;case c("PAKEMessageQplLoggingAction").END_SUCCESS:c("QPLUserFlow").endSuccess(d("MWPakeQPLEvents").pakeInitiatorQplEvent);break;case c("PAKEMessageQplLoggingAction").ADD_ERROR_ANNOTATION:j==null?c("FBLogger")("labyrinth_web").mustfix("PAKE: pakeMessageType is null when annotating PAKE error."):c("QPLUserFlow").addAnnotations(d("MWPakeQPLEvents").pakeInitiatorQplEvent,{"int":{errorCode:(i||(i=d("I64"))).to_int32(j)}});break}return(h||(h=b("Promise"))).resolve()};g["default"]=a}),98);
__d("LSDecryptPakeSecret",["LSLogMebClientEvent.nop","LSQplInteractionHelper.nop","LSSymmetricEncryptionCreateDecryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptPakeSecret] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_NO_SESSION_ONGOING_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[12]="PAKE: Failed to decrypt PAKE secrets as no session was ongoing.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,7]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,7]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,7])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[12]].join("")),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[12]].join(""),d[13],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[2]=a[0],d[3]=a[1],a}]):(f=e.item,c.sequence([function(e){return d[13]=f.responderId,d[14]=f.initiatorId,d[15]=f.pakeSecret,d[13]!==void 0?c.sequence([function(e){return d[14]!==void 0?c.sequence([function(e){return d[15]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_GENERATE_PAKE_AAD_START",c.i64.cast([0,0]),void 0)},function(a){return d[20]="_",c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_NATIVE_OP_START",c.i64.cast([0,0]),void 0)},function(e){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[1],c.blobs.of_string(["v1",d[20],c.i64.to_string(a[0]),d[20],d[13],d[20],d[14],d[20],c.i64.to_string(f.clientType)].join("")),d[15]).then(function(a){return a=a,d[21]=a[0],a})},function(e){return d[21]!==void 0?c.resolve((e=[d[21],c.i64.cast([0,0])],d[22]=e[0],d[23]=e[1],e)):c.sequence([function(a){return d[25]="PAKE: Failed to decrypt PAKE secrets as key was incorrect.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,10]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,10]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,10])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[25]].join("")),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[25]].join(""),d[26],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967295])],d[22]=a[0],d[23]=a[1],a}])},function(a){return a=[d[22],d[23]],d[18]=a[0],d[19]=a[1],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_PAKE_SECRET_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[21]="PAKE: Failed to decrypt PAKE secrets as there was no secret to decrypt.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[21]].join("")),d[22]=c.createArray(),void 0!==void 0?d[23]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[21]].join(""),d[22],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[18]=a[0],d[19]=a[1],a}])},function(a){return a=[d[18],d[19]],d[16]=a[0],d[17]=a[1],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_INITIATOR_ID_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[19]="PAKE: Failed to decrypt PAKE secrets as initiator id was null.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[19]].join("")),d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[19]].join(""),d[20],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[16]=a[0],d[17]=a[1],a}])},function(a){return a=[d[16],d[17]],d[11]=a[0],d[12]=a[1],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_RESPONDER_ID_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[17]="PAKE: Failed to decrypt PAKE secrets as responder id was null.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[17]].join("")),d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[17]].join(""),d[18],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[11]=a[0],d[12]=a[1],a}])},function(a){return a=[d[11],d[12]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptPakeSecret] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptPakeSecret",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSDecryptPakeSecretStoredProcedure",["LSDecryptPakeSecret","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.sessionId;d[1]=b.encryptionKey;d[2]=b.clientType;return c("LSDecryptPakeSecret").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSFinishAddPeerDevice",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDataTrace","LSCreateDataTraceID.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateSignature_v2.nop","LSDeleteBackupOnClient","LSFlushDataTrace.nop","LSGenerateLocalKeys","LSGetBlobFromString.nop","LSGetEncryptionVersionFromSupportedVersionsList.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Beginning execution."),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))&&c.i64.eq(a.backupTenancy,c.i64.cast([0,2]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?d[1]=!1:(a.item,d[1]=!0)})},function(a){return d[1]?d[3]=c.i64.or_(c.i64.cast([0,88]),c.i64.cast([0,128])):d[3]=c.i64.cast([0,88]),c.sequence([function(a){return c.nativeOperation(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[12]=a[0],a})},function(a){return c.sequence([function(a){return d[16]="EncryptedBackups MCD Trace ID",d[17]=c.i64.to_string(d[3]),d[15]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",d[15],d[16],d[15],d[17]].join("")),c.resolve()},function(a){return c.storedProcedure(b("LSCreateDataTrace"),d[12],void 0,void 0,"qr_add_device_receiver",d[3])}])},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[15],c.i64.cast([0,3]))):c.resolve()},function(a){return d[4]=d[12]}])},function(a){return c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,1434]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[12]=a[0],a})},function(a){return d[12]?d[13]=!0:d[13]=!1,d[13]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[14],c.i64.cast([0,3]))):c.resolve()}])},function(e){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(a){return c.db.table(168).fetch().next().then(function(a,d){var e=a.done;a=a.value;return e?0:(d=a.item,c.storedProcedure(b("LSDeleteBackupOnClient"),d.backupId,void 0,!1,void 0,"null",!0))})},function(e){return d[12]=a[0].get("backup_id"),a[0],c.storedProcedure(b("LSGenerateLocalKeys"),!1).then(function(a){return a=a,d[13]=a[0],d[14]=a[1],a})},function(e){return d[13]!==void 0?c.sequence([function(a){return d[15]=d[13].get("device_key"),d[13],d[16]=d[13].get("epoch_storage_key"),d[13],d[17]=d[13].get("epoch_auth_key"),d[13],d[18]=d[15].get("device_private_key"),d[15],d[19]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[50]=(d[19].push(c.i64.cast([0,0])),d[19]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[50]=(d[19].push(c.i64.cast([0,2])),d[19]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[50]=(d[19].push(c.i64.cast([0,3])),d[19]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[50]=(d[19].push(c.i64.cast([0,4])),d[19]):0,d[24]="",d[25]=c.i64.of_int32(d[19].length),c.i64.gt(d[25],c.i64.cast([0,0]))?c.loopAsync(d[25],function(a){return d[50]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[19],d[50]).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return d[24]=[d[24],"_",c.i64.to_string(d[51])].join("")}])}):c.resolve()},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),["supported_versions_",d[24],"revision_version_",c.i64.to_string(c.i64.cast([0,1]))].join("")).then(function(a){return a=a,d[26]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[18],c.blob("Mg=="),d[26]).then(function(a){return a=a,d[27]=a[0],a})},function(a){return c.blobs.neq(d[27],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[27]).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[28]=d[50]}]):c.resolve(d[28]=void 0)},function(a){return c.count(c.db.table(191).fetch()).then(function(a){return d[29]=a})},function(a){return c.i64.neq(d[29],c.i64.cast([0,0]))?c.sequence([function(a){return d[50]=c.createArray(),c.forEach(c.filter(c.db.table(191).fetch(),function(a){return c.i64.eq(d[12],a.backupId)}),function(a){var e=a.item;return c.sequence([function(a){return d[61]=c.createArray(),c.forEach(c.db.table(192).fetch([[[e.deviceId]]]),function(a){var e=a.item;return c.sequence([function(a){return d[64]=e.supportedVersion,c.storedProcedure(b("LSIsEncryptionVersionSecure"),d[64]).then(function(a){return a=a,d[63]=a[0],a})},function(a){return d[63]?d[65]=(d[61].push(d[64]),d[61]):0}])})},function(a){return d[62]=c.i64.of_int32(d[61].length),c.i64.gt(d[62],c.i64.cast([0,0]))?d[63]=(d[50].push(d[61]),d[50]):0}])})},function(a){return d[51]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[52]=a[0],a})},function(a){return d[52]?d[61]=(d[51].push(c.i64.cast([0,0])),d[51]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[53]?d[61]=(d[51].push(c.i64.cast([0,2])),d[51]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[54]?d[61]=(d[51].push(c.i64.cast([0,3])),d[51]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[55]=a[0],a})},function(a){return d[55]?d[61]=(d[51].push(c.i64.cast([0,4])),d[51]):0,d[56]=c.createArray(),d[57]=c.i64.of_int32(d[51].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(a){return d[61]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],d[61]).then(function(a){return a=a,d[62]=a[0],d[63]=a[1],a})},function(a){return d[64]=(d[56].push(d[62]),d[56])}])}):c.resolve()},function(a){return d[61]=(d[50].push(d[56]),d[50]),c.nativeOperation(b("LSGetEncryptionVersionFromSupportedVersionsList.nop"),d[50]).then(function(a){return a=a,d[58]=a[0],a})},function(a){return d[59]=void 0,c.i64.neq(d[59],void 0)?c.resolve(d[60]=d[59]):c.sequence([function(a){return d[61]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[62]=a[0],a})},function(a){return d[62]?d[71]=(d[61].push(c.i64.cast([0,0])),d[61]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[63]=a[0],a})},function(a){return d[63]?d[71]=(d[61].push(c.i64.cast([0,2])),d[61]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[64]=a[0],a})},function(a){return d[64]?d[71]=(d[61].push(c.i64.cast([0,3])),d[61]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[65]=a[0],a})},function(a){return d[65]?d[71]=(d[61].push(c.i64.cast([0,4])),d[61]):0,d[66]=c.createArray(),d[67]=c.i64.of_int32(d[61].length),c.i64.gt(d[67],c.i64.cast([0,0]))?c.loopAsync(d[67],function(a){return d[71]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[61],d[71]).then(function(a){return a=a,d[72]=a[0],d[73]=a[1],a})},function(a){return d[74]=(d[66].push(d[72]),d[66])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[71]=c.createArray(),d[72]=c.i64.of_int32(d[66].length),c.i64.gt(d[72],c.i64.cast([0,0]))?c.loopAsync(d[72],function(a){return d[74]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[66],d[74]).then(function(a){return a=a,d[75]=a[0],d[76]=a[1],a})},function(a){return d[77]=(d[71].push(c.i64.to_string(d[75])),d[71])}])}):c.resolve()},function(a){return d[73]=d[71].join(","),d[68]=d[73]}])},function(a){return d[66].some(function(a){return c.i64.eq(d[58],a)})?d[69]=d[58]:d[69]=void 0,c.i64.neq(d[69],void 0)?d[70]=d[69]:d[70]=void 0,d[60]=d[70]}])},function(a){return c.i64.neq(d[60],void 0)?c.resolve(0):(d[61]=["Returning unsupported encyption version, version not supported: ",c.i64.to_string(d[58])].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsVersioningUtils] ","",d[61]].join("")),d[62]=c.createArray(),void 0!==void 0?d[63]=(d[62].push(void 0),d[62]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsVersioningUtils",[d[61]].join(""),d[62],c.i64.cast([0,3])))},function(a){return d[30]=d[58]}]):c.sequence([function(a){return function(a){c.logger(a).warn(a)}("[EncryptedBackups][LSEncryptedBackupsVersioningUtils] Device versions table not populated when adding device using QR code"),d[50]=c.createArray(),void 0!==void 0?d[51]=(d[50].push(void 0),d[50]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsVersioningUtils","Device versions table not populated when adding device using QR code",d[50],c.i64.cast([0,2]))},function(a){return d[30]=c.i64.cast([0,0])}])},function(e){return d[31]=a[0].get("temp_ocmf_client_state"),a[0],c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),d[31]).then(function(a){return a=a,d[32]=a[0],d[33]=a[1],a})},function(a){return c.blobs.neq(void 0,void 0)?c.sequence([function(a){return c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),void 0).then(function(a){return a=a,d[50]=a[0],d[51]=a[1],a})},function(a){return a=[d[32],d[33],d[50],d[51]],d[34]=a[0],d[35]=a[1],d[36]=a[2],d[37]=a[3],a}]):c.resolve((a=[d[32],d[33],void 0,void 0],d[34]=a[0],d[35]=a[1],d[36]=a[2],d[37]=a[3],a))},function(b){return d[38]=d[15].get("device_public_key"),d[15],d[39]=d[15].get("device_private_key"),d[15],d[40]=d[16].get("epoch_storage_public_key"),d[16],d[41]=d[16].get("epoch_storage_private_key"),d[16],d[42]=d[17].get("epoch_auth_public_key"),d[17],d[43]=d[17].get("epoch_auth_private_key"),d[17],d[44]=a[0].get("mailbox_root_key"),a[0],d[45]=a[0].get("oblivious_validation_token"),a[0],c.forEach(c.filter(c.db.table(168).fetch([[[d[12]]]]),function(a){return c.i64.eq(a.backupId,d[12])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(168).add({backupId:d[12],devicePublicKeyBlob:d[38],devicePrivateKeyBlob:d[39],epochStoragePublicKeyBlob:d[40],epochStoragePrivateKeyBlob:d[41],epochAuthPublicKeyBlob:d[42],epochAuthPrivateKeyBlob:d[43],mailboxRootKeyBlob:d[44],ocmfClientStateBlob:d[34],obliviousValidationTokenBlob:d[45],authorityLevel:c.i64.cast([0,20]),backupTenancy:c.i64.cast([0,1]),revisionVersion:c.i64.cast([0,1]),encryptionVersion:d[30]})},function(e){return d[46]=a[0].get("add_peer_epoch_data"),a[0],d[47]=c.i64.of_int32(d[46].length),c.i64.gt(d[47],c.i64.cast([0,0]))?c.loopAsync(d[47],function(a){return d[50]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],d[50]).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return d[53]=d[51].get("epoch_id"),d[51],d[54]=d[51].get("epoch_anon_id"),d[51],d[55]=d[51].get("epoch_root_key"),d[51],d[56]=d[51].get("epoch_status"),d[51],c.forEach(c.filter(c.db.table(169).fetch([[[d[53]]]]),function(a){return c.i64.eq(a.epochId,d[53])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,80]))}),function(a){return a["delete"]()})},function(a){return c.db.table(169).add({epochId:d[53],authorityLevel:c.i64.cast([0,80]),backupId:d[12],epochAnonIdBlob:d[54],epochRootKeyBlob:d[55],epochStatus:d[56]})}])}):c.resolve()},function(a){return c.count(c.db.table(169).fetch()).then(function(a){return d[48]=a})},function(a){return c.i64.le(d[48],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch().next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return d[52]="No epoch available in epochs table",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[52]].join("")),d[53]=c.createArray(),void 0!==void 0?d[54]=(d[53].push(void 0),d[53]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[52]].join(""),d[53],c.i64.cast([0,3]))},function(a){return d[50]=void 0}]):(e=a.item,d[52]=new c.Map(),d[52].set("epoch_id",e.epochId),d[52].set("backup_id",e.backupId),d[52].set("epoch_anon_id_blob",e.epochAnonIdBlob),d[52].set("epoch_root_key_blob",e.epochRootKeyBlob),d[52].set("epoch_status",e.epochStatus),d[52].set("authority_level",e.authorityLevel),d[50]=d[52])})},function(a){return d[49]=d[50]}]):c.sequence([function(a){return d[50]="Multiple epochs available in epochs table",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[50]].join("")),d[51]=c.createArray(),void 0!==void 0?d[52]=(d[51].push(void 0),d[51]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[50]].join(""),d[51],c.i64.cast([0,3]))},function(a){return d[49]=void 0}])},function(e){return d[49]!==void 0?c.sequence([function(a){return d[50]=d[49].get("epoch_anon_id_blob"),d[49],d[51]=d[49].get("epoch_root_key_blob"),d[49],d[52]=d[15].get("device_public_key"),d[15],d[53]=c.createArray(),d[57]=(d[53].push(c.i64.cast([0,32])),d[53]),c.nativeOperation(b("LSBase64Encode.nop"),d[50]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[54]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blobs.of_string(["epoch_devices","_",d[54]].join("")),void 0,d[51],d[53]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[57]?d[58]=!1:d[58]=!0,d[58]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),d[60]=c.createArray(),void 0!==void 0?d[62]=(d[60].push(void 0),d[60]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",d[60],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[61]=a[0],a})},function(a){return d[59]=d[61]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[57],c.i64.cast([0,0])).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],a})},function(a){return d[59]=d[60]}])},function(a){return d[55]=d[59]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),d[57]=c.createArray(),void 0!==void 0?d[59]=(d[57].push(void 0),d[57]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",d[57],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[58]=a[0],a})},function(a){return d[55]=d[58]}])},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),d[55],d[52]).then(function(a){return a=a,d[56]=a[0],a})},function(e){return c.blobs.neq(d[56],void 0)?c.sequence([function(a){return d[57]=d[15].get("device_public_key"),d[15],c.nativeOperation(b("LSBase64Encode.nop"),d[57]).then(function(a){return a=a,d[58]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[56]).then(function(a){return a=a,d[59]=a[0],a})},function(a){return d[60]=d[49].get("epoch_root_key_blob"),d[49],c.blobs.neq(d[60],void 0)?c.sequence([function(a){return d[87]=c.createArray(),d[93]=(d[87].push(c.i64.cast([0,18])),d[87]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[60],d[87]).then(function(a){return a=a,d[88]=a[0],a})},function(a){return d[88]!==void 0?c.sequence([function(a){return d[93]=c.i64.of_int32(d[88].length),c.i64.ge(d[93],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[88],c.i64.cast([0,0])).then(function(a){return a=a,d[95]=a[0],d[96]=a[1],a})},function(a){return d[94]=d[95]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[95]=c.createArray(),void 0!==void 0?d[96]=(d[95].push(void 0),d[95]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[95],c.i64.cast([0,3]))},function(a){return d[94]=void 0}])},function(a){return d[89]=d[94]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[93]=c.createArray(),void 0!==void 0?d[94]=(d[93].push(void 0),d[93]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[93],c.i64.cast([0,3]))},function(a){return d[89]=void 0}])},function(a){return c.blobs.neq(d[89],void 0)?d[90]=!0:d[90]=!1,d[90]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[89]).then(function(a){return a=a,d[91]=a[0],a})},function(a){return d[91]!==void 0?d[92]=d[91]:d[92]="encodingfailed",d[61]=d[92]}]):c.resolve(d[61]="null")},function(a){return d[62]=d[16].get("epoch_storage_public_key"),d[16],c.nativeOperation(b("LSBase64Encode.nop"),d[62]).then(function(a){return a=a,d[63]=a[0],a})},function(a){return d[64]=d[13].get("epoch_storage_public_key_sig"),d[13],c.nativeOperation(b("LSBase64Encode.nop"),d[64]).then(function(a){return a=a,d[65]=a[0],a})},function(a){return d[66]=d[17].get("epoch_auth_public_key"),d[17],c.nativeOperation(b("LSBase64Encode.nop"),d[66]).then(function(a){return a=a,d[67]=a[0],a})},function(a){return d[68]=d[13].get("epoch_auth_public_key_sig"),d[13],c.nativeOperation(b("LSBase64Encode.nop"),d[68]).then(function(a){return a=a,d[69]=a[0],a})},function(e){return d[70]=d[15].get("device_private_key"),d[15],d[71]=a[0].get("mailbox_root_key"),a[0],d[72]=d[16].get("epoch_storage_private_key"),d[16],c.blobs.neq(d[71],void 0)?c.sequence([function(a){return d[87]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[71],"private_key",d[70],c.i64.cast([0,1]),d[87]).then(function(a){return a=a,d[88]=a[0],a})},function(a){return c.blobs.neq(d[88],void 0)?d[89]=d[88]:d[89]=void 0,d[73]=d[89]}]):c.resolve(d[73]=void 0)},function(a){return c.blobs.neq(d[73],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[73]).then(function(a){return a=a,d[87]=a[0],a})},function(a){return d[74]=d[87]}]):c.resolve(d[74]=void 0)},function(a){return c.blobs.neq(d[71],void 0)?c.sequence([function(a){return d[87]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[71],"ocmf_client_state",d[34],c.i64.cast([0,1]),d[87]).then(function(a){return a=a,d[88]=a[0],a})},function(a){return c.blobs.neq(d[88],void 0)?d[89]=d[88]:d[89]=void 0,d[75]=d[89]}]):c.resolve(d[75]=void 0)},function(a){return c.blobs.neq(d[75],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[75]).then(function(a){return a=a,d[87]=a[0],a})},function(a){return d[76]=d[87]}]):c.resolve(d[76]=void 0)},function(a){return c.blobs.neq(d[71],void 0)?c.sequence([function(a){return d[87]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[71],"epoch_storage_private_key",d[72],c.i64.cast([0,1]),d[87]).then(function(a){return a=a,d[88]=a[0],a})},function(a){return c.blobs.neq(d[88],void 0)?d[89]=d[88]:d[89]=void 0,d[77]=d[89]}]):c.resolve(d[77]=void 0)},function(a){return c.blobs.neq(d[77],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[77]).then(function(a){return a=a,d[87]=a[0],a})},function(a){return d[78]=d[87]}]):c.resolve(d[78]=void 0)},function(e){return d[79]=a[0].get("backup_id"),a[0],c.nativeOperation(b("LSBase64Encode.nop"),d[35]).then(function(a){return a=a,d[80]=a[0],a})},function(e){return d[81]=a[0].get("server_data_id"),a[0],d[82]=d[49].get("epoch_id"),d[49],d[83]=new c.Map(),d[83].set("supported_encryption_versions",d[19]),d[83].set("client_version",c.i64.cast([0,1])),d[83].set("version_sig",d[28]==null?"":d[28]),d[84]=new c.Map(),d[84].set("backup_id",d[79]),d[84].set("device_epoch_hmac",d[59]==null?"":d[59]),d[84].set("epoch_root_key_fingerprint",d[61]),d[84].set("device_public_key",d[58]==null?"":d[58]),d[84].set("epoch_auth_pubkey",d[67]==null?"":d[67]),d[84].set("epoch_auth_pubkey_sig",d[69]==null?"":d[69]),d[84].set("epoch_storage_pubkey",d[63]==null?"":d[63]),d[84].set("epoch_storage_pubkey_sig",d[65]==null?"":d[65]),d[84].set("ocmf_rotation_token",d[80]==null?"":d[80]),d[84].set("server_data_id",d[81]),d[84].set("device_registration_id",a[1]),d[84].set("base_epoch_id",d[82]),d[84].set("encryption_version_data",d[83]),d[84].set("private_key_debug_token",d[74]),d[84].set("ocmf_client_state_debug_token",d[76]),d[84].set("epoch_storage_pvtkey_debug_token",d[78]),d[84].set("trace_id",d[4]),d[84].set("occam_only_eligible",!0),d[85]=c.toJSON(d[84]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50017]),d[85],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),d[4],c.i64.cast([0,0])).then(function(a){return a=a,d[86]=a[0],a})}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] $device_epoch_hmac found to be null"),d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),"[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] $device_epoch_hmac found to be null",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[58]=a[0],a})},function(a){return d[58]?d[59]=!0:d[59]=!1,d[59]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[60]=c.createArray(),void 0!==void 0?d[61]=(d[60].push(void 0),d[60]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[60],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[57]=c.createArray(),d[4]!==void 0?d[58]=(d[57].push(d[4]),d[57]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","$device_epoch_hmac found to be null",d[57],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[12],"backup_init_flow",!0,d[4],void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! There should be exactly one open epoch. Deleting local state and terminating device addition"),d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),"[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! There should be exactly one open epoch. Deleting local state and terminating device addition",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[51]=a[0],a})},function(a){return d[51]?d[52]=!0:d[52]=!1,d[52]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[53]=c.createArray(),void 0!==void 0?d[54]=(d[53].push(void 0),d[53]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[53],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[50]=c.createArray(),d[4]!==void 0?d[51]=(d[50].push(d[4]),d[50]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! There should be exactly one open epoch. Deleting local state and terminating device addition",d[50],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[12],"backup_init_flow",!0,d[4],void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! Error in generating the keys. Deleting local state and terminating device addition"),d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),"[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! Error in generating the keys. Deleting local state and terminating device addition",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[18],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[15]=c.createArray(),d[4]!==void 0?d[16]=(d[15].push(d[4]),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! Error in generating the keys. Deleting local state and terminating device addition",d[15],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[12],"backup_init_flow",!0,d[4],void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):(e.item,d[12]="An authoritative row already exists, aborting execution of add peer device",d[12]!==void 0?c.sequence([function(a){return d[14]=["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[12]].join(""),function(a){c.logger(a).mustfix(a)}(d[14]),d[13]=c.createArray(),d[4]!==void 0?d[15]=(d[13].push(d[4]),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",d[12],d[13],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[14],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]=c.createArray(),void 0!==void 0?d[20]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[19],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]?d[16]=!0:d[16]=!1,d[16]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[17]=c.createArray(),void 0!==void 0?d[18]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[17],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]?d[16]=!0:d[16]=!1,d[16]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[17]=c.createArray(),void 0!==void 0?d[18]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[17],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[15],c.i64.cast([0,3]))):c.resolve()}]))})},function(a){return d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSDeserializeSecretsAndAddDevice",["LSArrayGetObjectAt","LSBase64Decode.nop","LSDeserializeFromJsonIntoDictionaryV2.nop","LSFinishAddPeerDevice","LSQplInteractionHelper.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_START",c.i64.cast([0,0]),void 0)},function(e){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_END",c.i64.cast([0,0]),void 0)},function(a){return d[1]=d[0].get("temp_ocmf_client_state"),d[0],c.nativeOperation(b("LSBase64Decode.nop"),d[1]).then(function(a){return a=a,d[2]=a[0],a})},function(a){return d[3]=d[0].get("mailbox_root_key"),d[0],c.nativeOperation(b("LSBase64Decode.nop"),d[3]).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[5]=d[0].get("oblivious_validation_token"),d[0],c.nativeOperation(b("LSBase64Decode.nop"),d[5]).then(function(a){return a=a,d[6]=a[0],a})},function(a){return d[7]=c.createArray(),d[8]=d[0].get("add_peer_epoch_data_serializable"),d[0],d[9]=c.i64.of_int32(d[8].length),c.i64.gt(d[9],c.i64.cast([0,0]))?c.loopAsync(d[9],function(a){return d[14]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[8],d[14]).then(function(a){return a=a,d[15]=a[0],d[16]=a[1],a})},function(a){return d[17]=d[15].get("epoch_anon_id"),d[15],c.nativeOperation(b("LSBase64Decode.nop"),d[17]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[19]=d[15].get("epoch_root_key"),d[15],c.nativeOperation(b("LSBase64Decode.nop"),d[19]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[21]=d[15].get("epoch_id"),d[15],d[22]=d[15].get("epoch_status"),d[15],d[23]=new c.Map(),d[23].set("epoch_id",d[21]),d[23].set("epoch_anon_id",d[18]==null?c.blob(""):d[18]),d[23].set("epoch_root_key",d[20]==null?c.blob(""):d[20]),d[23].set("epoch_status",d[22]),d[24]=(d[7].push(d[23]),d[7])}])}):c.resolve()},function(e){return d[10]=d[0].get("backup_id"),d[0],d[11]=d[0].get("server_data_id"),d[0],d[12]=new c.Map(),d[12].set("backup_id",d[10]),d[12].set("server_data_id",d[11]),d[12].set("temp_ocmf_client_state",d[2]==null?c.blob(""):d[2]),d[12].set("mailbox_root_key",d[4]==null?c.blob(""):d[4]),d[12].set("oblivious_validation_token",d[6]==null?c.blob(""):d[6]),d[12].set("add_peer_epoch_data",d[7]),d[12]!==void 0?c.sequence([function(e){return c.storedProcedure(b("LSFinishAddPeerDevice"),d[12],a[1])},function(a){return d[13]=!0}]):c.resolve(d[13]=!1)},function(a){return e[0]=d[13]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSDeserializeSecretsAndAddDeviceStoredProcedure",["LSDeserializeSecretsAndAddDevice","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.serializedPayload;d[1]=b.deviceRegistrationId;return c("LSDeserializeSecretsAndAddDevice").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSGetActiveSession",["LSLogMebClientEvent.nop","LSQplInteractionHelper.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][getActiveSession] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.count(c.filter(c.db.table(258).fetch(),function(b){return c.i64.eq(b.messageType,c.i64.cast([0,0]))&&c.i64.eq(b.clientType,a[1])&&b.initiatorId===void 0||c.i64.eq(b.clientType,a[1])&&b.initiatorId===a[0]&&![c.i64.cast([0,1]),c.i64.cast([0,2]),c.i64.cast([0,3]),c.i64.cast([0,4]),c.i64.cast([0,21]),c.i64.cast([0,15])].some(function(a){return c.i64.eq(b.messageType,a)})&&c.i64.neq(b.sessionId,c.i64.cast([-1,4294967295]))})).then(function(a){return d[2]=a})},function(e){return c.i64.le(d[2],c.i64.cast([0,1]))?c.sequence([function(e){return c.filter(c.db.table(258).fetch(),function(b){return c.i64.eq(b.messageType,c.i64.cast([0,0]))&&c.i64.eq(b.clientType,a[1])&&b.initiatorId===void 0||c.i64.eq(b.clientType,a[1])&&b.initiatorId===a[0]&&![c.i64.cast([0,1]),c.i64.cast([0,2]),c.i64.cast([0,3]),c.i64.cast([0,4]),c.i64.cast([0,21]),c.i64.cast([0,15])].some(function(a){return c.i64.eq(b.messageType,a)})&&c.i64.neq(b.sessionId,c.i64.cast([-1,4294967295]))}).next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,17]))},function(a){return a=[c.i64.cast([-1,4294967295]),void 0,void 0],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]):(e=a.item,c.sequence([function(a){return d[19]=e.responderId,d[19]!==void 0?c.resolve((a=[c.i64.cast([0,0]),e.sessionId,d[19]],d[16]=a[0],d[17]=a[1],d[18]=a[2],a)):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_SESSION_ONGOING_RESPONDER_ID_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(a){return a=[c.i64.cast([-1,4294967294]),void 0,void 0],d[16]=a[0],d[17]=a[1],d[18]=a[2],a}])},function(a){return a=[d[16],d[17],d[18]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]))})},function(a){return a=[d[12],d[13],d[14]],d[3]=a[0],d[4]=a[1],d[5]=a[2],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,18]))},function(a){return a=[c.i64.cast([-1,4294967294]),void 0,void 0],d[3]=a[0],d[4]=a[1],d[5]=a[2],a}])},function(a){return d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][getActiveSession] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"getActiveSession",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[3],d[4],d[5]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSGetActiveSessionStoredProcedure",["LSGetActiveSession","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.initiatorId;d[1]=b.clientType;return c("LSGetActiveSession").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSSendOTCNotifications",["LSIssueNewEbTaskAndGetTaskIDV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.forEach(c.db.table(285).fetch(),function(a){return a["delete"]()})},function(a){return c.forEach(c.filter(c.db.table(285).fetch([[[c.i64.cast([0,1])]]]),function(a){return c.i64.eq(a.pk,c.i64.cast([0,1]))&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(285).add({pk:c.i64.cast([0,1]),notificationSendingStatus:c.i64.cast([0,2]),authorityLevel:c.i64.cast([0,20])})},function(e){return d[0]=new c.Map(),d[0].set("device_ids",a[0]),d[1]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_send_otc_notifications",c.i64.cast([0,50032]),d[1],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[2]=a[0],a})}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSSendOTCNotificationsStoredProcedure",["LSSendOTCNotifications","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.deviceIds;return c("LSSendOTCNotifications").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSSendPakeMessage",["LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][sendPakeMessage] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[4])&&c.i64.eq(b.sessionId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[4])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,7]),clientType:a[4]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,7])})}))}):(f=e.item,d[9]=new c.Map(),d[9].set("session_id",a[0]),d[9].set("responder_id",f.responderId),d[9].set("initiator_id",f.initiatorId),d[9].set("message_payload",a[2]==null?f.messagePayload:a[2]),d[9].set("pake_secret",f.pakeSecret),d[9].set("sender_id",a[1]),d[9].set("message_type",a[3]),d[9].set("client_type",a[4]),d[10]=c.toJSON(d[9]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"PakeMessages",c.i64.cast([0,717]),d[10],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[11]=a[0],a}))})},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][sendPakeMessage] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"sendPakeMessage",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSSendPakeMessageOne",["LSBase64Encode.nop","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSQplInteractionHelper.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][sendPakeMessageOne] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.nativeOperation(b("LSBase64Encode.nop"),a[2]).then(function(a){return a=a,d[2]=a[0],a})},function(e){return c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[3])&&c.i64.eq(b.sessionId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,7]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[3])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,7]),clientType:a[3]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,7])})}))})}]):(f=e.item,d[10]=f.responderId,d[10]!==void 0?(d[11]=new c.Map(),d[11].set("session_id",a[0]),d[11].set("responder_id",d[10]),d[11].set("initiator_id",a[1]),d[11].set("message_payload",d[2]==null?"":d[2]),d[11].set("pake_secret",void 0),d[11].set("sender_id",a[1]),d[11].set("message_type",c.i64.cast([0,1])),d[11].set("client_type",a[3]),d[12]=c.toJSON(d[11]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"PakeMessages",c.i64.cast([0,717]),d[12],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[13]=a[0],a})):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[3])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[3]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})}]))})},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][sendPakeMessageOne] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"sendPakeMessageOne",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSSendPakeMessageOneStoredProcedure",["LSSendPakeMessageOne","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.sessionId;d[1]=b.initiatorId;d[2]=b.messagePayload;d[3]=b.clientType;return c("LSSendPakeMessageOne").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSSendPakeMessageStoredProcedure",["LSSendPakeMessage","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.sessionId;d[1]=b.senderId;d[2]=b.messagePayload;d[3]=b.messageType;d[4]=b.clientType;return c("LSSendPakeMessage").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MWChatEncryptedBackupsAccessCodeInputStep.react",["fbt","CometProgressButtonIndeterminate.react","EBSMGating","MWChatEncryptedBackupsAccessCodeInput.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsSetIsDialogPersistedContext","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEncryptedBackupsLocalStorageEntryEnum","MWXButton.react","MWXText.react","QPLUserFlow","gkx","promiseDone","react","requireDeferred","useEncryptedBackupsQplImpressionRef","useLabyrinthLogging","useMAWEncryptedBackupsRestoreToast","useMWChatEncryptedBackupsAddDevice","useMWEBFlowSourceContext","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));b=j;var l=b.useCallback,m=b.useContext,n=b.useState,o=c("requireDeferred")("MWEBUseLocalStorage").__setRef("MWChatEncryptedBackupsAccessCodeInputStep.react"),p=c("requireDeferred")("MWEncryptedBackupsSharedState").__setRef("MWChatEncryptedBackupsAccessCodeInputStep.react"),q=h._("__JHASH__T0C_5M__5DH__JHASH__");function a(a){var b=a.onChooseOtc,e=a.onComplete,f=a.onForgotRC;a=a.shouldShowForgotButton;a=a===void 0?!0:a;var g=(i||(i=c("useReStore")))(),j=h._("__JHASH__7iiwqV3Z6Ok__JHASH__"),r=n(""),s=r[0],t=r[1];r=n(!1);var u=r[0],v=r[1];r=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var w=r.startFlow,x=m(c("MWChatEncryptedBackupsSetIsDialogPersistedContext")).setIsDialogPersisted;r=l(function(){d("MWChatEncryptedBackupsLogging").endFailure({errorName:"wrong_recovery_code",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityKey:c("MWEBODSEntityKey.enum").INCORRECT_RECOVERY_CODE,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_RC_RESTORE_AUTH}),c("QPLUserFlow").markError(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"invalid_recovery_code_input"),v(!0),x==null?void 0:x(!1)},[x]);var y=c("useMAWEncryptedBackupsRestoreToast")(),z=y.showErrorToast,A=c("useMWEBFlowSourceContext")();y=function(a){u&&v(!1),t(a)};r=c("useMWChatEncryptedBackupsAddDevice")({onComplete:l(function(){var a;c("QPLUserFlow").addPoint((a=d("MWChatEncryptedBackupsQPLEvents")).restoreDeviceAuthQplEvent,"add_device_success");c("QPLUserFlow").addPoint(a.restoreQplEvent,"restore_auth_finished_and_dismissed");p.onReady(function(a){a=a.upsertEBSharedStateEntry;c("promiseDone")(a({db:g,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY}))});o.onReady(function(a){var b=a.mwEBCreateLocalStorageEntry;a=a.mwEBDeleteLocalStorageEntry;c("gkx")("2249")&&b(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT);b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION);b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION_2);a(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE)});d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{is_backend_setup:d("EBSMGating").isBackendSetupSuccessfulForEBSM()}},event:a.restoreQplEvent});d("MWChatEncryptedBackupsLogging").endSuccess({event:a.restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_RC_RESTORE_AUTH});e()},[g,e]),onFailure:l(function(a){d("MWChatEncryptedBackupsLogging").endFailure({errorName:a,event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endFailure({errorName:a,event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_RC_RESTORE_AUTH}),z(),x==null?void 0:x(!1)},[x,z]),onInvalidRecoveryCode:r});var B=r[0];r=r[1];var C=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_ENTER_RECOVERY_CODE_SCREEN_IMPRESSION",function(){D!=null&&c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_OPTION_DISPLAYED_RESTORE_SCREEN")});a=a?k.jsx(c("MWXButton.react"),{label:h._("__JHASH__TJHhepIDy5c__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_ENTER_RECOVERY_CODE_SCREEN_ACTION_DONT_HAVE_RC"),f()},testid:void 0,type:"secondary"}):null;var D=b!==null?k.jsx(c("MWXButton.react"),{label:h._("__JHASH__rIytKXj5Yr0__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_USE_ONE_TIME_CODE_CLICK"),b()},reduceEmphasis:!1,testid:void 0,type:"secondary"}):null;a=D!=null?D:a;return k.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",primaryAction:r?k.jsx(c("CometProgressButtonIndeterminate.react"),{label:q}):k.jsx(c("MWXButton.react"),{disabled:s.length<40,label:q,onPress:function(){var a;c("QPLUserFlow").addPoint((a=d("MWChatEncryptedBackupsQPLEvents")).restoreQplEvent,"RESTORE_ENTER_RECOVERY_CODE_SCREEN_ACTION_SUBMIT");var b=A();c("QPLUserFlow").addAnnotations(a.restoreQplEvent,{string:{restore_type:"recovery_code",source:b}});w({additionalAnnotations:{device_type:"OFFLINE"},event:a.restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_RC_RESTORE_AUTH});c("QPLUserFlow").addPoint(a.restoreDeviceAuthQplEvent,"add_device_begin");x==null?void 0:x(!0);B(s)},testid:void 0}),ref:C,secondaryAction:r?null:a,showTopMargin:!1,title:h._("__JHASH__8BMtxO3Z_MC__JHASH__"),children:[k.jsx("div",{className:"xwib8y2",children:k.jsx(c("MWXText.react"),{type:"meta3",children:j})}),k.jsx(c("MWChatEncryptedBackupsAccessCodeInput.react"),{onValueChange:y,smallInput:!1,value:s}),u?k.jsx("div",{className:"x5ib6vp xc73u3c xz9dl7a",children:k.jsx(c("MWXText.react"),{align:"center",color:"negative",testid:void 0,type:"meta3",children:h._("__JHASH__a6pa6P3ejkP__JHASH__")})}):null]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWChatEncryptedBackupsAppFacebookconSmall.react",["ix","MWXIcon.react","cr:1376","fbicon","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(){var a=b("cr:1376")!=null?new(b("cr:1376"))(h("391025"),16,16):d("fbicon")._(h("869051"),20);return j.jsx(c("MWXIcon.react"),{icon:a,size:20})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatEncryptedBackupsAppMessengerIconSmall.react",["MWXIconAppMessenger","MWXIconStrict.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(){return i.jsx(c("MWXIconStrict.react"),{icon:c("MWXIconAppMessenger"),size:20})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatEncryptedBackupsAutoRestoreConsentStep.react",["fbt","CometRelay","FocusRegion.react","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWDialogText.react","MWEBUpsellDismissedEnum.facebook","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","MWXButton.react","MWXColumn.react","MWXColumnItem.react","MWXDialogPageLegacy.react","MWXMultiStepDialogHeader.react","MWXRow.react","MWXRowItem.react","QPLUserFlow","focusScopeQueries","gkx","promiseDone","react","requireDeferred","stylex","useEncryptedBackupsQplImpressionRef","xplatToDOMRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||d("react"),l=c("requireDeferred")("updateUpsellsStateInRelayStore").__setRef("MWChatEncryptedBackupsAutoRestoreConsentStep.react"),m=c("gkx")("23219"),n={fdsBodyContainer:{paddingBottom:"xwib8y2",paddingEnd:"x1pi30zi",paddingStart:"x1swvt13",$$css:!0},fdsContent:{paddingBottom:"x1l90r2v",paddingTop:"xyamay9",$$css:!0},fdsCtaContainer:{paddingBottom:"xwib8y2",paddingTop:"xyamay9",$$css:!0},mdsBodyContainer:{minHeight:"x2lwn1j",$$css:!0},mdsContent:{paddingBottom:"x1l90r2v",paddingTop:"x1y1aw1k",$$css:!0},mdsCtaContainer:{paddingBottom:"xwib8y2",paddingTop:"xyamay9",$$css:!0},mdsHeadingContainer:{marginTop:"x9otpla",$$css:!0}};function a(a){var b=a.onComplete,e=d("CometRelay").useRelayEnvironment();a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,"AUTO_RESTORE_CONSENT_SCREEN_IMPRESSION");return k.jsxs(c("MWXDialogPageLegacy.react"),{includeFDSContentPadding_REMOVE_THIS_AFTER_CONTENT_PADDING_MIGRATION:!1,ref:d("xplatToDOMRef").xplatToDOMRef(a),children:[k.jsx("div",{className:(i||(i=c("stylex")))(m?n.mdsHeadingContainer:null),children:k.jsx(c("MWXMultiStepDialogHeader.react"),{title:h._("__JHASH__oOLwSyBIK6Q__JHASH__"),withCloseButton:!1,withoutBackButton:!0})}),k.jsx("div",{className:i(m?n.mdsBodyContainer:n.fdsBodyContainer),children:k.jsxs(c("MWXColumn.react"),{align:"center",testid:void 0,children:[k.jsx(c("MWXColumnItem.react"),{align:m?"center":"start",children:k.jsx("div",{className:i(m?n.mdsContent:n.fdsContent),children:k.jsx(c("MWDialogText.react"),{align:"start",testid:void 0,type:"body",children:h._("__JHASH__8Pc1AS8cP5M__JHASH__")})})}),k.jsx(c("MWXColumnItem.react"),{align:"stretch",children:k.jsx("div",{className:i(m?n.mdsCtaContainer:n.fdsCtaContainer),children:k.jsxs(c("MWXRow.react"),{align:"end",paddingHorizontal:0,paddingVertical:0,spacing:8,children:[k.jsx(c("MWXRowItem.react"),{expanding:m,children:k.jsx(c("MWXButton.react"),{label:h._("__JHASH__qYs0K2Ysi-h__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,"AUTO_RESTORE_CONSENT_DECLINE_CTA_CLICK"),d("MWEBUseLocalStorage").mwEBDeleteLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent}),c("promiseDone")(l.load(),function(a){a({environment:e,updateValue:d("MWEBUpsellDismissedEnum.facebook").MWEBUpsellDismissedStateEnum.ALL_DISMISSED})}),b()},reduceEmphasis:!m,testid:void 0,type:"secondary"})}),k.jsx(c("MWXRowItem.react"),{expanding:m,children:k.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").tabbableScopeQuery,children:k.jsx(c("MWXButton.react"),{label:h._("__JHASH__9UXa8IqlGXK__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,"AUTO_RESTORE_CONSENT_CONFIRM_CTA_CLICK"),d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent}),c("promiseDone")(l.load(),function(a){a({environment:e,updateValue:d("MWEBUpsellDismissedEnum.facebook").MWEBUpsellDismissedStateEnum.ALL_DISMISSED})}),b()},padding:"wide",testid:void 0,type:"primary"})})})]})})})]})})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWChatEncryptedBackupsCreatePinInstruction.react",["fbt","MWChatEncryptedBackupsForgotPinInformationalResetPin.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsRecoveryCodeIcon.react","MWChatEncryptedBackupsRestoreEndOfRoadDialog.react","MWXButton.react","MWXLink.react","MWXListCell.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","deferredLoadComponent","react","requireDeferred","useEncryptedBackupsQplImpressionRef","useMWEncryptedBackupsListenForChangesToVirtualDevicesV2"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;var k=b.useCallback,l=b.useState,m=c("deferredLoadComponent")(c("requireDeferred")("MWChatEncryptedBackupsPinCodeRestoreStep.react").__setRef("MWChatEncryptedBackupsCreatePinInstruction.react")),n="https://www.facebook.com/help/messenger-app/3357856081116516?ref=learn_more";function a(a){var b=a.onClose,e=a.onComplete,f=a.pushPage;a=l(!0);var g=a[0];a=a[1];var i=c("useMWEncryptedBackupsListenForChangesToVirtualDevicesV2")(),o=i.vestaClientID;g&&o!=null&&a(!1);var p=k(function(){return f(function(){return j.jsx(c("MWChatEncryptedBackupsRestoreEndOfRoadDialog.react"),{onClose:b})})},[b,f]),q=k(function(){return f(function(){return j.jsx(c("MWChatEncryptedBackupsForgotPinInformationalResetPin.react"),{onClose:b,onComplete:e,pushPage:f})})},[b,f,e]),r=k(function(){return f(function(){return o==null?null:j.jsx(m,{clientID:o,onChooseOtc:null,onClose:b,onComplete:e,onForgotPin:q})})},[b,e,f,o,q]);i=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_PIN_SCREEN_IMPRESSION");return j.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",icon:j.jsx(c("MWChatEncryptedBackupsRecoveryCodeIcon.react"),{}),primaryAction:j.jsx(c("MWXButton.react"),{disabled:g,label:h._("__JHASH__azfzhOvLeld__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_PIN_SCREEN_ENTER_PIN_CLICK"),r()}}),ref:i,secondaryAction:j.jsx(c("MWXButton.react"),{label:h._("__JHASH__JYt7hk4FEPk__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_PIN_SCREEN_CANT_CREATE_PIN_CLICK"),p()},type:"secondary"}),children:[j.jsx("div",{className:"xewm4ob",children:j.jsx(c("MWXText.react"),{align:"center",type:"headlineEmphasized2",children:h._("__JHASH__r-UBPe_4xvO__JHASH__")})}),j.jsxs("div",{className:"x169t7cy x19f6ikt xm77wn2 xvue9z",children:[j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{headline:h._("__JHASH__I5BWRfz9kj6__JHASH__"),level:4,meta:j.jsxs(j.Fragment,{children:[h._("__JHASH__66f6j4edNUW__JHASH__")," ",j.jsx(c("MWXLink.react"),{display:"inline",href:n,onClick:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_PIN_SCREEN_LEARN_MORE_LINK_CLICK")},rel:"noreferrer",target:"_blank",children:j.jsx("b",{children:h._("__JHASH__yk1kU3qH_5u__JHASH__")})})]})})}),j.jsx("br",{}),j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{headline:h._("__JHASH__6OnapwRiU-I__JHASH__"),level:4,meta:j.jsxs(c("MWXText.react"),{type:"meta4",children:[h._("__JHASH__Hyp2Dk13FKd__JHASH__"),j.jsx("br",{}),h._("__JHASH__KtIvQ3G8r-K__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__mnPynM3vIb8__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__YLnPm0Rvu_i__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__8Oq20T6QwSt__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__Bvgp1w5pZ4___JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__0zO-AR2mh_u__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__M34cp2-7gGO__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__0dYzuV-3JUF__JHASH__")}))])]})})})]})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("pushRCRestoreStep",["MWEncryptedBackupsForgotRCStep","MWEncryptedBackupsOtcRestoreSteps","deferredLoadComponent","react","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferred")("MWChatEncryptedBackupsAccessCodeInputStep.react").__setRef("pushRCRestoreStep"));function a(a){var b=a.doesUserHaveOtcEligibleDevices,c=a.onClose,e=a.onComplete,f=a.onForgotRC,g=a.pushPage,h=a.shouldShowForgotButton;a=function(){d("MWEncryptedBackupsForgotRCStep").pushForgotRCPage({onClose:c,onComplete:e,pushPage:g})};var k=(f=f)!=null?f:a;g(function(){return i.jsx(j,{onChooseOtc:b===!0?function(){return d("MWEncryptedBackupsOtcRestoreSteps").pushByOneTimeCodePage({onOtcComplete:e,pushPage:g})}:null,onComplete:e,onForgotRC:k,shouldShowForgotButton:h})})}g["default"]=a}),98);
__d("MWChatEncryptedBackupsGenerateNewRecoveryCodeInstruction.react",["fbt","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsRecoveryCodeIcon.react","MWChatEncryptedBackupsRestoreEndOfRoadDialog.react","MWXButton.react","MWXLink.react","MWXListCell.react","MWXMultiStepDialogHeader.react","MWXTextPairing.react","QPLUserFlow","cr:5458","pushRCRestoreStep","react","useEncryptedBackupsQplImpressionRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k="https://www.facebook.com/help/messenger-app/3357856081116516?ref=learn_more";function a(a){var e=a.onClose,f=a.onCloseDialogWithConfirmation,g=a.onComplete,i=a.onDontRestore,l=a.pushPage,m=f!=null,n=b("cr:5458")==null?void 0:b("cr:5458")(),o=function(){l(function(){return j.jsxs(j.Fragment,{children:[m?j.jsx(c("MWXMultiStepDialogHeader.react"),{onClose:f,title:null,withCloseButton:!0,withoutBackButton:!0}):null,j.jsx(c("MWChatEncryptedBackupsRestoreEndOfRoadDialog.react"),{onClose:g,onDontRestore:i})]})})};a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_TROUBLESHOOT_RC_SCREEN_IMPRESSION");return j.jsx(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",icon:j.jsx(c("MWChatEncryptedBackupsRecoveryCodeIcon.react"),{}),primaryAction:j.jsx(c("MWXButton.react"),{label:h._("__JHASH__DnKZRulcqGe__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_TROUBLESHOOT_RC_SCREEN_ACTION_ENTER_CODE");var a=n!=null?n.onPushAutoRestoreConsentPage(l,g):e;c("pushRCRestoreStep")({onClose:e,onComplete:a,pushPage:l,shouldShowForgotButton:!1})},testid:void 0}),ref:a,secondaryAction:j.jsx(c("MWXButton.react"),{label:h._("__JHASH__wkez3K_SoHV__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_TROUBLESHOOT_RC_SCREEN_ACTION_CANT_GENERATE_CODE"),o()},type:"secondary"}),title:h._("__JHASH__qROoBeCmzeY__JHASH__"),children:j.jsxs("div",{className:"xvue9z",children:[j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{body:j.jsxs(j.Fragment,{children:[h._("__JHASH__D6e8Mh9DE8a__JHASH__")," ",j.jsx(c("MWXLink.react"),{display:"inline",href:k,onClick:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_TROUBLESHOOT_SCREEN_ACTION_OPEN_LEARN_MORE_LINK")},rel:"noreferrer",target:"_blank",children:j.jsx("b",{children:h._("__JHASH__yk1kU3qH_5u__JHASH__")})})]}),bodyColor:"secondary",headline:h._("__JHASH__aZTN0eX3kw4__JHASH__"),level:4})}),j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{body:j.jsxs(j.Fragment,{children:[h._("__JHASH__HG5XJ8DHe4v__JHASH__"),j.jsx("br",{}),h._("__JHASH__ZfRAIOlNhhF__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__mnPynM3vIb8__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__8h6q580afos__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__8Oq20T6QwSt__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__XEDcoIgGX9g__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__0zO-AR2mh_u__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__TJHGYNx1Byx__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__ORhXAbatdS9__JHASH__")}))])]}),bodyColor:"secondary",headline:h._("__JHASH__csYZJmhxxDs__JHASH__"),level:4})})]})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWChatEncryptedBackupsCreateRecoveryCodeInstruction.react",["fbt","MWChatEncryptedBackupsGenerateNewRecoveryCodeInstruction.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsRecoveryCodeIcon.react","MWChatEncryptedBackupsRestoreEndOfRoadDialog.react","MWXButton.react","MWXLink.react","MWXListCell.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","cr:5458","pushRCRestoreStep","react","useEncryptedBackupsQplImpressionRef","useMWEncryptedBackupsListenForChangesToVirtualDevicesV2"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));e=i;var k=e.useCallback,l=e.useState,m="https://www.facebook.com/help/messenger-app/3357856081116516?ref=learn_more";function a(a){var e=a.onClose,f=a.onComplete,g=a.pushPage;a=l(!0);var i=a[0];a=a[1];var n=c("useMWEncryptedBackupsListenForChangesToVirtualDevicesV2")();n=n.offlineDevicesCount;var o=b("cr:5458")==null?void 0:b("cr:5458")();i&&n>0&&a(!1);var p=k(function(){return g(function(){return j.jsx(c("MWChatEncryptedBackupsRestoreEndOfRoadDialog.react"),{onClose:e})})},[e,g]),q=k(function(){return g(function(){return j.jsx(c("MWChatEncryptedBackupsGenerateNewRecoveryCodeInstruction.react"),{onClose:e,onComplete:f,pushPage:g})})},[e,f,g]);n=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_RC_SCREEN_IMPRESSION");return j.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",icon:j.jsx(c("MWChatEncryptedBackupsRecoveryCodeIcon.react"),{}),primaryAction:j.jsx(c("MWXButton.react"),{disabled:i,label:h._("__JHASH__5c2KiSYPIxj__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_RC_SCREEN_ENTER_CODE_CLICK");var a=o!=null?o.onPushAutoRestoreConsentPage(g,f):e;c("pushRCRestoreStep")({onClose:e,onComplete:a,onForgotRC:q,pushPage:g,shouldShowForgotButton:!1})}}),ref:n,secondaryAction:j.jsx(c("MWXButton.react"),{label:h._("__JHASH__wkez3K_SoHV__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_RC_SCREEN_CANT_GENERATE_CODE_CLICK"),p()},type:"secondary"}),children:[j.jsx("div",{className:"xewm4ob",children:j.jsx(c("MWXText.react"),{align:"center",type:"headlineEmphasized2",children:h._("__JHASH__ePYUiQEv2Jf__JHASH__")})}),j.jsxs("div",{className:"x169t7cy x19f6ikt xm77wn2 xvue9z",children:[j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{headline:h._("__JHASH__j4tUcRVJrVr__JHASH__"),level:4,meta:j.jsxs(j.Fragment,{children:[h._("__JHASH__LvOpAmvQ9Zs__JHASH__")," ",j.jsx(c("MWXLink.react"),{display:"inline",href:m,onClick:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_RC_SCREEN_LEARN_MORE_LINK_CLICK")},rel:"noreferrer",target:"_blank",children:j.jsx("b",{children:h._("__JHASH__JFv5llOM1oL__JHASH__")})})]})})}),j.jsx("br",{}),j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{headline:h._("__JHASH__PbR9w7iOzwd__JHASH__"),level:4,meta:j.jsxs(c("MWXText.react"),{type:"meta4",children:[h._("__JHASH__HG5XJ8DHe4v__JHASH__"),j.jsx("br",{}),h._("__JHASH__ZfRAIOlNhhF__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__mnPynM3vIb8__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__8h6q580afos__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__8Oq20T6QwSt__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__XEDcoIgGX9g__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__0zO-AR2mh_u__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__TJHGYNx1Byx__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__ORhXAbatdS9__JHASH__")}))])]})})})]})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWChatEncryptedBackupsForgotPinStep.react",["fbt","MWChatEncryptedBackupsAddonIcon.react","MWChatEncryptedBackupsChevronRightIconMedium.react","MWChatEncryptedBackupsForgotPinInformationalResetPin.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsMobileRotateIconSmall.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsTextIconSmall.react","MWXListCellPressable.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","cr:5458","pushRCRestoreStep","react","useEncryptedBackupsQplImpressionRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){var e=a.isRCDeviceEnabled,f=a.onClose,g=a.onComplete,i=a.pushPage,k=function(){i(function(){return j.jsx(c("MWChatEncryptedBackupsForgotPinInformationalResetPin.react"),{onClose:f,onComplete:g,pushPage:i})})};a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_OPTIONS_SCREEN_IMPRESSION");var l=b("cr:5458")==null?void 0:b("cr:5458")();return j.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",ref:a,showTopMargin:!1,title:h._("__JHASH__aG4R6bxLQ0N__JHASH__"),children:[j.jsx(c("MWXText.react"),{type:"meta3",children:h._("__JHASH__MeLYonSVEOM__JHASH__")}),j.jsxs("div",{className:"x9a3u73 x1p5oq8j xfdjxqc",children:[j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWChatEncryptedBackupsChevronRightIconMedium.react"),{}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWChatEncryptedBackupsMobileRotateIconSmall.react"),{})}),addOnStartVerticalAlign:"center","aria-label":h._("__JHASH__S1KydYJcRDi__JHASH__"),content:j.jsx(c("MWXTextPairing.react"),{body:h._("__JHASH__S1KydYJcRDi__JHASH__"),bodyColor:"secondary",headline:h._("__JHASH__QIw_F3RIyEo__JHASH__"),level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_OPTIONS_SCREEN_ACTION_RESET_PIN"),k()},testid:void 0}),e?j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWChatEncryptedBackupsChevronRightIconMedium.react"),{}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWChatEncryptedBackupsTextIconSmall.react"),{})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXText.react"),{align:"start",type:"headlineEmphasized4",children:h._("__JHASH__yY8fizSLvt5__JHASH__")}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_OPTIONS_SCREEN_ACTION_ENTER_RECOVERY_CODE");var a=l!=null?l.onPushAutoRestoreConsentPage(i,g):f;c("pushRCRestoreStep")({onClose:f,onComplete:a,pushPage:i,shouldShowForgotButton:!0})},testid:void 0}):null]})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWChatEncryptedBackupsKVSOnlyRestoreStep.react",["fbt","MWChatEncryptedBackupsAddonIcon.react","MWChatEncryptedBackupsChevronRightIconMedium.react","MWChatEncryptedBackupsCreatePinInstruction.react","MWChatEncryptedBackupsCreateRecoveryCodeInstruction.react","MWChatEncryptedBackupsDots3HorizontalIconSmall.react","MWChatEncryptedBackupsInterstitialIcon.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsTextIconSmall.react","MWXListCellPressable.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","react","useEncryptedBackupsQplImpressionRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useCallback;function a(a){var b=a.onClose,e=a.onComplete,f=a.pushPage,g=k(function(){return f(function(){return j.jsx(c("MWChatEncryptedBackupsCreatePinInstruction.react"),{onClose:b,onComplete:e,pushPage:f})})},[b,e,f]),i=k(function(){return f(function(){return j.jsx(c("MWChatEncryptedBackupsCreateRecoveryCodeInstruction.react"),{onClose:b,onComplete:e,pushPage:f})})},[b,e,f]);a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_OPTIONS_IMPRESSION");return j.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",icon:j.jsx(c("MWChatEncryptedBackupsInterstitialIcon.react"),{}),innerContentPaddingVertical:0,ref:a,title:h._("__JHASH__JiPJcQZ2ODs__JHASH__"),children:[j.jsx(c("MWXText.react"),{color:"secondary",type:"body4",children:h._("__JHASH__KBLSFG_4ok9__JHASH__")}),j.jsxs("div",{className:"x1miatn0 x2b8uid xk68kj7",children:[j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWChatEncryptedBackupsChevronRightIconMedium.react"),{}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWChatEncryptedBackupsDots3HorizontalIconSmall.react"),{})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXTextPairing.react"),{headline:h._("__JHASH__U-M3lpEzQQ___JHASH__"),level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_PIN_CODE_CLICK"),g()}}),j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWChatEncryptedBackupsChevronRightIconMedium.react"),{}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWChatEncryptedBackupsTextIconSmall.react"),{})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXTextPairing.react"),{headline:h._("__JHASH__X81OWLrHpAK__JHASH__"),level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_RECOVERY_CODE_CLICK"),i()}})]})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWDeserializeSecretsAndAddDevice",["LSDeserializeSecretsAndAddDeviceStoredProcedure","LSFactory"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.initiatorId,d=a.secrets;a=a.storage;return a.runInTransaction(function(a){return c("LSDeserializeSecretsAndAddDeviceStoredProcedure")(c("LSFactory")(a),{deviceRegistrationId:b,serializedPayload:d})},"readwrite",void 0,void 0,f.id+":31")}g["default"]=a}),98);
__d("MWXIconCommentLeftRight",["MWXSvgIcon","SVGIcon","cr:9102","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgIcon(d("SVGIcon").svgIcon(b("cr:9102")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMobileFilled",["MWXSvgIcon","SVGIcon","cr:9882","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgIcon(d("SVGIcon").svgIcon(b("cr:9882")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconQuestionCircle",["MWXSvgIcon","SVGIcon","cr:9267","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgIcon(d("SVGIcon").svgIcon(b("cr:9267")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWEBRestoreMoreOptionsStep.react",["fbt","FBLogger","MWChatEncryptedBackupsAddonIcon.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsVirtualDevicesContext.react","MWEncryptedBackupsOtcRestoreSteps","MWXColumn.react","MWXColumnItem.react","MWXDialogPage.react","MWXDivider.react","MWXIconChevronRight","MWXIconCommentLeftRight","MWXIconMobileFilled","MWXIconQuestionCircle","MWXIconStrict.react","MWXIconText","MWXListCellPressable.react","MWXMultiStepDialogHeader.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","gkx","pushRCRestoreStep","react","stylex","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react")),l=j.useContext,m="https://www.facebook.com/help/messenger-app/1084673321594605",n={MWXDialogPageComet:{marginBottom:"x1wsgfga",marginTop:"x1rdy4ex",$$css:!0},MWXDialogPageMsgr:{paddingTop:"x1y1aw1k",$$css:!0}},o=c("gkx")("23433");function a(a){var b=a.onCloseDialog,e=a.onComplete,f=a.onOptOut,g=a.pushPage;a=c("useVisibilityObserver")({onVisible:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_STEP_IMPRESSION")}});var j=l(c("MWChatEncryptedBackupsVirtualDevicesContext.react")),p=j.virtualDeviceInfo;!p.doesUserHaveOtcEligibleDevices&&p.offlineDevicesCount===0&&(c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_STEP_NO_RESTORE_OPTIONS"),c("FBLogger")("labyrinth_web").warn("[labyrinth][web] User has no restore option when entering more options dialog"));return k.jsx(c("MWXDialogPage.react"),{footer:null,header:k.jsx(c("MWXMultiStepDialogHeader.react"),{title:h._("__JHASH__S6uVrUILoAH__JHASH__"),withCloseButton:!1,withoutBackButton:!0,withoutHeaderBottomBorder:!1}),children:k.jsx("div",{className:(i||(i=c("stylex")))(o?n.MWXDialogPageMsgr:n.MWXDialogPageComet),children:k.jsxs(c("MWXColumn.react"),{align:"center",paddingHorizontal:0,paddingTop:0,ref:a,spacing:8,children:[k.jsx(c("MWXColumnItem.react"),{align:"start",children:k.jsx(c("MWXText.react"),{color:"secondary",type:"body3",children:h._("__JHASH__pKOHbuzxMOV__JHASH__")})}),k.jsx(c("MWXColumnItem.react"),{align:"start",expanding:!0,children:k.jsx("div",{className:"xp7jhwk x1n0m28w x2b8uid",children:k.jsxs(c("MWXColumn.react"),{expanding:!0,spacing:8,children:[p.doesUserHaveOtcEligibleDevices&&k.jsx(c("MWXColumnItem.react"),{children:k.jsx(c("MWXListCellPressable.react"),{addOnEnd:k.jsx(c("MWXIconStrict.react"),{color:"secondary",icon:c("MWXIconChevronRight"),size:20}),addOnEndVerticalAlign:"center",addOnStart:k.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:k.jsx(c("MWXIconStrict.react"),{backgroundEnabled:!0,icon:c("MWXIconMobileFilled"),size:36})}),addOnStartVerticalAlign:"center",content:k.jsx(c("MWXTextPairing.react"),{body:h._("__JHASH__yvGg-Qb4PZo__JHASH__"),bodyColor:"secondary",headline:h._("__JHASH__L7kzbcXm2Sk__JHASH__"),headlineColor:"primary",level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_USE_OTC_CLICK"),d("MWEncryptedBackupsOtcRestoreSteps").pushByOneTimeCodePage({onOtcComplete:e,pushPage:g})},size:"large",testid:void 0})}),p.offlineDevicesCount>0?k.jsx(c("MWXColumnItem.react"),{children:k.jsx(c("MWXListCellPressable.react"),{addOnEnd:k.jsx(c("MWXIconStrict.react"),{color:"secondary",icon:c("MWXIconChevronRight"),size:20}),addOnEndVerticalAlign:"center",addOnStart:k.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:k.jsx(c("MWXIconStrict.react"),{backgroundEnabled:!0,icon:c("MWXIconText"),size:36})}),addOnStartVerticalAlign:"center",content:k.jsx(c("MWXTextPairing.react"),{body:h._("__JHASH__ZCep7nFsJ3n__JHASH__"),bodyColor:"secondary",headline:h._("__JHASH__yY8fizSLvt5__JHASH__"),headlineColor:"primary",level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_USE_RC_CLICK"),c("pushRCRestoreStep")({doesUserHaveOtcEligibleDevices:p.doesUserHaveOtcEligibleDevices,onClose:b,onComplete:e,pushPage:g})},size:"large",testid:void 0})}):null,k.jsx(c("MWXColumnItem.react"),{children:k.jsx(c("MWXListCellPressable.react"),{addOnEnd:k.jsx(c("MWXIconStrict.react"),{color:"secondary",icon:c("MWXIconChevronRight"),size:20}),addOnEndVerticalAlign:"center",addOnStart:k.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:k.jsx(c("MWXIconStrict.react"),{backgroundEnabled:!0,icon:c("MWXIconCommentLeftRight"),size:36})}),addOnStartVerticalAlign:"center",content:k.jsx(c("MWXTextPairing.react"),{body:h._("__JHASH__qZFJcCPvvtk__JHASH__"),bodyColor:"secondary",headline:h._("__JHASH__fqR_0SOwJUV__JHASH__"),headlineColor:"primary",level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_DO_NOT_RESTORE_CLICK"),f()},size:"large",testid:void 0})}),k.jsx(c("MWXColumnItem.react"),{paddingHorizontal:8,children:k.jsx(c("MWXDivider.react"),{})}),k.jsx(c("MWXColumnItem.react"),{children:k.jsx(c("MWXListCellPressable.react"),{addOnEnd:k.jsx(c("MWXIconStrict.react"),{color:"secondary",icon:c("MWXIconChevronRight"),size:20}),addOnEndVerticalAlign:"center",addOnStart:k.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:k.jsx(c("MWXIconStrict.react"),{backgroundEnabled:!0,icon:c("MWXIconQuestionCircle"),size:36})}),addOnStartVerticalAlign:"center",content:k.jsx(c("MWXTextPairing.react"),{bodyColor:"secondary",headline:h._("__JHASH__94rkJHAT5R0__JHASH__"),headlineColor:"primary",level:4}),linkProps:{target:"_blank",url:m},onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_NEED_HELP_CLICK")},size:"large",testid:void 0})})]})})})]})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("pushEBRestoreMoreOptionsStep",["deferredLoadComponent","react","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferred")("MWEBRestoreMoreOptionsStep.react").__setRef("pushEBRestoreMoreOptionsStep"));function a(a){var b=a.onCloseDialog,c=a.onComplete,d=a.pushPage;d(function(){return i.jsx(j,{onCloseDialog:b,onComplete:c,onOptOut:b,pushPage:d})})}g["default"]=a}),98);
__d("MWEBRestoreOTCFirstStep.react",["fbt","MWChatEncryptedBackupsQPLEvents","MWEBSyncIcon.react","MWXColumn.react","MWXColumnItem.react","MWXDialogFooter.react","MWXDialogPage.react","MWXText.react","QPLUserFlow","pushEBRestoreMoreOptionsStep","react","requireDeferredForDisplay","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k=c("requireDeferredForDisplay")("MWEncryptedBackupsOtcRestoreSteps").__setRef("MWEBRestoreOTCFirstStep.react");function a(a){var b=a.onCloseDialog,e=a.onComplete,f=a.pushPage;a=c("useVisibilityObserver")({onVisible:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_DIALOG_STEP_IMPRESSION")}});return j.jsx(c("MWXDialogPage.react"),{footer:j.jsx(c("MWXDialogFooter.react"),{callToActionGroupDirection:"backward",primaryCallToAction:{label:h._("__JHASH__95blpFaRbPC__JHASH__"),onPress:function(){k.onReadyImmediately(function(a){a=a.pushByOneTimeCodePage;c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_SEND_CODE_CLICK");a({onOtcComplete:e,pushPage:f})})}},secondaryCallToAction:{label:h._("__JHASH__OFSirhauIwo__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_CLICK"),c("pushEBRestoreMoreOptionsStep")({onCloseDialog:b,onComplete:e,pushPage:f})}}}),header:null,children:j.jsxs(c("MWXColumn.react"),{align:"center",paddingHorizontal:16,paddingVertical:8,ref:a,spacing:16,children:[j.jsx(a=c("MWXColumnItem.react"),{align:"center",paddingTop:20,paddingVertical:4}),j.jsx(a,{align:"center",paddingTop:0,paddingVertical:8,children:j.jsx(c("MWEBSyncIcon.react"),{})}),j.jsx(a,{align:"center",children:j.jsx(c("MWXText.react"),{align:"center",color:"primary",type:"headlineEmphasized2",children:h._("__JHASH__XjJsWmK0iIY__JHASH__")})}),j.jsx(a,{align:"center",children:j.jsx(c("MWXText.react"),{align:"center",color:"secondary",type:"body3",children:h._("__JHASH__tNC5yN0XFze__JHASH__")})})]})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWEncryptedBackupsOTCShowNotificationSentToast",["fbt","ix","MWChatEncryptedBackupsQPLEvents","QPLUserFlow","SVGIcon","cr:4027","cr:6570","fbicon","mwPushToast","react"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||d("react");function a(){var a=b("cr:6570")?k.jsx(b("cr:6570"),{icon:d("fbicon")._(i("477815"),24)}):void 0,e=b("cr:4027")?d("SVGIcon").svgIcon(b("cr:4027")):void 0;d("mwPushToast").mwPushToast({body:h._("__JHASH__jo46UlZ-CxV__JHASH__"),icon:{comet:a,mds:e},testid:"mw-chat-encrypted-backups-otc-notification-sent-successful-toast"});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_NOTIFICATION_SENT_SUCCESSFUL_TOAST")}g.showOTCNotificationSentToast=a}),226);
__d("MWEncrypedBackupsSendOTCNotifications",["FBLogger","I64","LSAuthorityLevel","LSEncryptedBackupsOpStatus","LSFactory","LSSendOTCNotificationsStoredProcedure","LSVec","MWEncryptedBackupsOTCShowNotificationSentToast","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.db,e=a.onFailure,g=a.onStart,i=a.onSuccess,j=a.onTableUnsubscribe;a=a.otcEligibleDevices;var k=function(a){return b.runInTransaction(function(b){return c("LSSendOTCNotificationsStoredProcedure")(c("LSFactory")(b),{deviceIds:c("LSVec").ofArray(a)})},"readwrite",void 0,void 0,f.id+":46")},l=[];a.map(function(a){return l.push(a.deviceId)});g==null?void 0:g();yield k(l);a=d("ReQL").fromTableAscending(b.tables.encrypted_backups_otc_notification_sending_status);var m=a.subscribe(function(a,b){if(b.operation==="delete")return;a=b.value;if(a==null)return;b=(h||(h=d("I64"))).to_int32(a.authorityLevel);if(b!==c("LSAuthorityLevel").AUTHORITATIVE)return;m();j==null?void 0:j();switch((h||(h=d("I64"))).to_int32(a.notificationSendingStatus)){case c("LSEncryptedBackupsOpStatus").SUCCESS:d("MWEncryptedBackupsOTCShowNotificationSentToast").showOTCNotificationSentToast();i==null?void 0:i();break;case c("LSEncryptedBackupsOpStatus").FAILURE:e();break;case c("LSEncryptedBackupsOpStatus").UNKNOWN:c("FBLogger")("labyrinth_web").mustfix("OTC: Unexpected UNKNOWN status type for notification sending result.");break;default:c("FBLogger")("labyrinth_web").mustfix("OTC: Unexpected UNKNOWN status type for notification sending result.");break}});return m});return i.apply(this,arguments)}g.sendOTCNotifications=a}),98);
__d("MWEncryptedBackupsEligibleDeviceCell.react",["I64","MWChatEncryptedBackupsAddonIcon.react","MWChatEncryptedBackupsAppFacebookconSmall.react","MWChatEncryptedBackupsAppMessengerIconSmall.react","MWXListCell.react","MWXText.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||d("react"),k=[6628568379,173847642670370,350685531728];function a(a){var b=a.deviceAppId,e=a.deviceManufacturer,f=a.deviceModel;a=a.eligibleDeviceCellId;b=(a=b!=null&&k.includes((i||(i=d("I64"))).to_int32(b)))!=null?a:!1;return j.jsx(c("MWXListCell.react"),{addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:b?j.jsx(c("MWChatEncryptedBackupsAppFacebookconSmall.react"),{}):j.jsx(c("MWChatEncryptedBackupsAppMessengerIconSmall.react"),{})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXText.react"),{type:"headline4",children:e+" "+f}),size:"large",testid:void 0})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWEncryptedBackupsViewAllOtcEligibleDialogStep.react",["fbt","CometScrollableArea.react","FBLogger","FDSListCellGlimmer.react","MWChatEncryptedBackupsQPLEvents","MWEncrypedBackupsSendOTCNotifications","MWEncryptedBackupsEligibleDeviceCell.react","MWEncryptedBackupsOTCEligibleDevicesContext.react","MWXColumn.react","MWXColumnItem.react","MWXDialogPageLegacy.react","MWXMultiStepDialogHeader.react","MWXText.react","QPLUserFlow","gkx","promiseDone","react","useReStore","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));b=j;var l=b.useContext,m=b.useEffect,n=b.useRef,o=b.useState,p=c("gkx")("23219"),q="https://www.facebook.com/help/messenger-app/431055522328649?ref=learn_more",r={cellsScrollableAreaFds:{marginStart:"x1mh8g0r",marginLeft:null,marginRight:null,maxHeight:"xwazeda",paddingBottom:"x10b6aqq",width:"xh8yej3",$$css:!0},cellsScrollableAreaMds:{marginStart:"x1hk0nng",marginLeft:null,marginRight:null,maxHeight:"x8vp032",width:"xh8yej3",$$css:!0}};function a(a){var b=a.onFetchOtcEligibleDevicesError,e=a.onResendCodeFailure,f=a.onReturn;a=c("useVisibilityObserver")({onVisible:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_VIEW_ALL_DEVICES_SCREEN")}});var g=(i||(i=c("useReStore")))(),j=n(!1),s=n(function(){}),t=o(!1),u=t[0],v=t[1];t=l(d("MWEncryptedBackupsOTCEligibleDevicesContext.react").MWEncryptedBackupsOTCEligibleDevicesContext);var w=t.failedToFetchOtcDevices,x=t.isFetchOtcDevicesInFlight;t=t.otcEligibleDevices;var y=x?null:t.length;m(function(){(y===0||w)&&j.current===!1&&(j.current=!0,f(),b())},[w,y,b,f]);m(function(){return function(){s.current()}},[]);return k.jsxs(k.Fragment,{children:[k.jsx(c("MWXMultiStepDialogHeader.react"),{title:h._("__JHASH__MFhuz6OB9p3__JHASH__"),withCloseButton:!1,withoutBackButton:!0}),k.jsx(c("MWXDialogPageLegacy.react"),{callToActionGroupLayout:"expanded",primaryCallToAction:{label:h._("__JHASH__rgoYqsLs8Qq__JHASH__"),loading:u,onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_RESEND_CODE_CLICK"),c("promiseDone")(d("MWEncrypedBackupsSendOTCNotifications").sendOTCNotifications({db:g,onFailure:function(){v(!1),f(),e()},onStart:function(){v(!0)},onSuccess:function(){v(!1),f()},otcEligibleDevices:[]}),function(a){s.current=a},function(){c("FBLogger")("labyrinth_web").mustfix("OTC: Send otc notifications sproc failed."),f(),e()})}},ref:a,secondaryCallToAction:{label:h._("__JHASH__kVQyhECs96C__JHASH__"),linkProps:{target:"_blank",url:q},onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_CANT_ACCESS_CODE_CLICK")}},children:k.jsxs(c("MWXColumn.react"),{align:"center",paddingHorizontal:0,paddingVertical:0,spacing:16,children:[k.jsx(c("MWXColumnItem.react"),{align:"start",children:k.jsx("div",{className:"x977yut xyamay9",children:k.jsx(c("MWXText.react"),{color:"secondary",type:"body3",children:h._("__JHASH__t7U8UIKqWo9__JHASH__")})})}),k.jsx(c("MWXColumnItem.react"),{align:"start",children:x?k.jsx("div",{className:"x889kno x65xoit",children:k.jsx(c("FDSListCellGlimmer.react"),{imageStyle:"circle",paddingHorizontal:0})}):k.jsx(c("CometScrollableArea.react"),{horizontal:!1,xstyle:p?r.cellsScrollableAreaMds:r.cellsScrollableAreaFds,children:k.jsx(c("MWXColumn.react"),{align:"center",paddingHorizontal:0,paddingVertical:0,spacing:0,children:t.map(function(a,b){var d=a.appId,e=a.deviceId,f=a.manufacturer;a=a.model;return a!=null&&f!=null?k.jsx(c("MWXColumnItem.react"),{align:"start",children:k.jsx(c("MWEncryptedBackupsEligibleDeviceCell.react"),{deviceAppId:d,deviceManufacturer:f,deviceModel:a,eligibleDeviceCellId:"mw-chat-encrypted-backups-eligible-otc-device-"+b})},e):null})})})})]})})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MobileFilled12.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs("svg",babelHelpers["extends"]({viewBox:"0 0 12 13",width:"1em",height:"1em",fill:"currentColor"},a,{children:[a.title!=null&&i.jsx("title",{children:a.title}),a.children!=null&&i.jsx("defs",{children:a.children}),i.jsx("g",{fillRule:"evenodd",transform:"translate(-450 -1073)",children:i.jsx("path",{d:"M453 1082.5h6v-7h-6v7zm3.5 2h-1a.501.501 0 0 1-.5-.5c0-.275.225-.5.5-.5h1c.275 0 .5.225.5.5s-.225.5-.5.5zm2.25-11h-5.5c-.69 0-1.25.56-1.25 1.25v9.5c0 .69.56 1.25 1.25 1.25h5.5c.69 0 1.25-.56 1.25-1.25v-9.5c0-.69-.56-1.25-1.25-1.25z"})})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("PAKEDecryptSecretSprocStatusEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:0,WRONG_KEYS:-1,FAILURE:-2});f["default"]=a}),66);
__d("PAKEGetActiveSessionSprocStatusEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:0,NO_SESSION:-1,FAILURE:-2});f["default"]=a}),66);
__d("PAKEMessageTypeEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({AWAITING_CLIENT:0,PAKE_MESSAGE_1:1,PAKE_MESSAGE_2_AND_SECRET:2,SESSION_EXPIRED_ERROR:3,MAX_ATTEMPTS_ERROR:4,GENERIC_ERROR:5,MESSAGE_SENT_ERROR:6,PREVIOUS_MESSAGE_MISSING_ERROR:7,INVALID_PREVIOUS_MESSAGE_ERROR:8,ENCRYPTION_ERROR:9,DECRYPTION_ERROR:10,CPACE_STEP_2_ERROR:11,FETCH_SECRETS_ERROR:12,CPACE_STEP_1_ERROR:13,CPACE_STEP_3_ERROR:14,PAKE_HANDSHAKE_SUCCESS:15,SERIALIZATION_ERROR:16,NO_ACTIVE_SESSION:17,MULTIPLE_ACTIVE_SESSIONS_ERROR:18,PROCESS_SECRETS_ERROR:19,TIMEOUT_ERROR:20,FLOW_ABANDONED_ERROR:21,DESERIALIZE_SECRETS_ERROR:22,CODE_REQUESTED:23});f["default"]=a}),66);
__d("PakeInitiatorSprocCalls",["LSDecryptPakeSecretStoredProcedure","LSFactory","LSGetActiveSessionStoredProcedure","LSIntEnum","LSSendPakeMessageOneStoredProcedure","LSSendPakeMessageStoredProcedure","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=a.clientType,e=a.initiatorId,g=a.messagePayload,i=a.sessionId;a=a.storage;c("promiseDone")(a.runInTransaction(function(a){return c("LSSendPakeMessageOneStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),initiatorId:e,messagePayload:g,sessionId:i})},"readwrite",void 0,void 0,f.id+":45"))}function b(a){var b=a.clientType,e=a.initiatorId;a=a.storage;return a.runInTransaction(function(a){return c("LSGetActiveSessionStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),initiatorId:e})},"readwrite",void 0,void 0,f.id+":71")}function e(a){var b=a.clientType,e=a.encryptionKey,g=a.sessionId;a=a.storage;return a.runInTransaction(function(a){return c("LSDecryptPakeSecretStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),encryptionKey:e,sessionId:g})},"readwrite",void 0,void 0,f.id+":92")}function i(a){var b=a.clientType,e=a.messagePayload,g=a.messageType,i=a.senderId,j=a.sessionId;a=a.storage;return a.runInTransaction(function(a){return c("LSSendPakeMessageStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),messagePayload:e,messageType:h.ofNumber(g),senderId:i,sessionId:j})},"readwrite",void 0,void 0,f.id+":116")}g.sendPakeMessageOne=a;g.joinPakeSession=b;g.decryptPakeSecret=e;g.sendPakeMessage=i}),98);
__d("PakeQplLogging",["MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","ODS","QPLEvent","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){c("QPLUserFlow").getActiveFlowIDs().includes((h||(h=d("QPLEvent"))).getMarkerId(a))||((i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EB_OTC_AUTH,c("MWEBODSEntityKey.enum").START),c("QPLUserFlow").start(a,{annotations:{string:babelHelpers["extends"]({},b)}}))}function b(a,b,e){c("QPLUserFlow").endFailure(a,b,{annotations:e}),(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EB_OTC_AUTH,c("MWEBODSEntityKey.enum").FAIL)}function e(a,b){c("QPLUserFlow").endSuccess(a,{annotations:b}),(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EB_OTC_AUTH,c("MWEBODSEntityKey.enum").SUCCESS)}g.startPakeQPLFlow=a;g.endPakeQPLFlowFailure=b;g.endPakeQPLFlowSuccess=e}),98);
__d("deserializeSecretsAndAddDevice",["FBLogger","I64","LSEncryptedBackupsRecoveryCodeStatus","LSIntEnum","MWDeserializeSecretsAndAddDevice","MWEncryptedBackupsInitializeRestoreDeferred","MWPakeQPLEvents","PAKEMessageTypeEnum","PakeQplLogging","QPLUserFlow","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b=a.db,e=a.initiatorId,f=a.onAddDeviceFailure,g=a.onAddDeviceFinish;a=a.secrets;var j=function(){};c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_START");return c("MWDeserializeSecretsAndAddDevice")({initiatorId:e,secrets:a,storage:b}).then(function(a){a=a[0];a||(c("FBLogger")("labyrinth_web").mustfix("PAKE: deserializeSecretsAndAddDevice sproc failed"),d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_FAILURE",{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").DESERIALIZE_SECRETS_ERROR}}),f());j=d("ReQL").fromTableAscending(b.tables.secure_encrypted_backups_recovery_code_status).subscribe(function(a,e){if(e.operation==="add"||e.operation==="put"){a=e.value.recoveryCodeStatus;if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsRecoveryCodeStatus").VALID))){j();c("QPLUserFlow").addPoint((e=d("MWPakeQPLEvents")).pakeInitiatorQplEvent,"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_END");g();c("QPLUserFlow").addPoint(e.pakeInitiatorQplEvent,"MEB_INITIALIZE_RESTORE_START");d("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:b,onFailure:function(){d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"MEB_INITIALIZE_RESTORE_FAILURE",{bool:{isUserError:!1}})}});c("QPLUserFlow").addPoint(e.pakeInitiatorQplEvent,"MEB_INITIALIZE_RESTORE_END");d("PakeQplLogging").endPakeQPLFlowSuccess(e.pakeInitiatorQplEvent)}else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR)))c("FBLogger")("labyrinth_web").mustfix("PAKE: LSEncryptedBackupsFinishAddPeerDeviceTask task failed"),d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"MEB_FINISH_ADD_PEER_DEVICE_FAILURE",{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").DESERIALIZE_SECRETS_ERROR}}),f();else{e="PAKE: Unexpected recovery code status: "+(h||(h=d("I64"))).to_int32(a);c("FBLogger")("labyrinth_web").mustfix(e)}}});return j})["catch"](function(a){a="PAKE: error when adding new device using OTC, "+a;c("FBLogger")("labyrinth_web").mustfix(a);d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_EXCEPTION",{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").DESERIALIZE_SECRETS_ERROR},string:{exceptionMessage:a}});f();j();return function(){}})}g["default"]=a}),98);
__d("establishPakeHandshakeAsInitiator",["Base64Utils","FBLogger","I64","MWEncryptedBackupsDeviceRegistrationId","MWPakeQPLEvents","PAKECleanupSessionReasonEnum","PAKEDecryptSecretSprocStatusEnum","PAKEGetActiveSessionSprocStatusEnum","PAKEMessageTypeEnum","PakeCpaceUtils","PakeCpaceWasm","PakeQplLogging","QPLUserFlow","ReQL","asyncToGeneratorRuntime","clearTimeout","promiseDone","requireDeferred","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("CleanupPakeSession").__setRef("establishPakeHandshakeAsInitiator"),j=c("requireDeferred")("PakeInitiatorSprocCalls").__setRef("establishPakeHandshakeAsInitiator"),k=(h||(h=d("I64"))).of_int32(-1),l=3e3,m="PAKE_INITIATOR_FAILURE";function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.clientType,e=a.onGeneralFailure,f=a.onMaxAttemptsReached,g=a.onNoSessionExists,n=a.onSessionExpired,o=a.onSuccessfulSecretDecryption,p=a.onWrongOtc,q=a.otc,r=a.pakeCpaceModule,s=a.storage,t=a.timeout,u=function(){},v=function(){z&&c("clearTimeout")(z)},w=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(w===""){d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}});return{pakeClient:null,stopTimeout:v,unsubFromMessagesTable:u}}var x=(a=r)!=null?a:yield d("PakeCpaceWasm").PakeCPaceWasm(),y=x.createCPaceClient(w),z=null,A=null,B=!1,C=d("ReQL").fromTableAscending(s.tables.pake_messages),D=function(){z&&c("clearTimeout")(z),z=c("setTimeout")(function(){e(),u(),i.onReady(function(a){c("promiseDone")(a({cleanupReason:c("PAKECleanupSessionReasonEnum").TIMEOUT,clientType:b,deviceId:w,storage:s}))}),c("FBLogger")("labyrinth_web").mustfix("PAKE handshake failed by timeout")},t)},E=function(){A&&c("clearTimeout")(A),A=c("setTimeout")(function(){c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_CPACE_RETRY_JOIN_SESSION"),B=!0,M()},l)},F=function(a){var d=a.messageType,f=a.sessionId;e();j.onReady(function(a){c("promiseDone")(a.sendPakeMessage({clientType:b,messageType:d,senderId:w,sessionId:f,storage:s}))})},G=function(a){var e=a.messagePayload,f=a.responderId,g=a.sessionId;c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_CPACE_STEP_THREE_START");if(e==null){c("FBLogger")("labyrinth_web").mustfix("PAKE: When executing step 3 of CPace Handshake messagePayload was null");d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").INVALID_PREVIOUS_MESSAGE_ERROR}});return}if(f==null){c("FBLogger")("labyrinth_web").mustfix("PAKE: When executing step 3 of CPace Handshake responderId was null");d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").INVALID_PREVIOUS_MESSAGE_ERROR}});return}a=d("Base64Utils").toArrayBuffer(e);var i;try{f=x.clientFinalize(y,new Uint8Array(a));i=f.clientKey1}catch(a){F({messageType:c("PAKEMessageTypeEnum").CPACE_STEP_3_ERROR,sessionId:g});d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").CPACE_STEP_3_ERROR}});throw c("FBLogger")("labyrinth_web").mustfixThrow("PAKE: Error executing CPace step 3")}c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_DECRYPT_SECRET_START");j.onReady(function(a){c("promiseDone")(a.decryptPakeSecret({clientType:b,encryptionKey:d("PakeCpaceUtils").typedArrayToBuffer(i),sessionId:g,storage:s}),function(e){var f=e[0];e=e[1];v();switch((h||(h=d("I64"))).to_int32(e)){case c("PAKEDecryptSecretSprocStatusEnum").SUCCESS:if(f==null){d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}});throw c("FBLogger")("labyrinth_web").mustfixThrow("PAKE: decryptedSecret is null despite SPROC success")}c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_DECRYPT_SECRET_END");c("promiseDone")(a.sendPakeMessage({clientType:b,messageType:c("PAKEMessageTypeEnum").PAKE_HANDSHAKE_SUCCESS,senderId:w,sessionId:g,storage:s}));o({decryptedSecret:f,initiatorId:w});break;case c("PAKEDecryptSecretSprocStatusEnum").WRONG_KEYS:d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!0}});p();break;case c("PAKEDecryptSecretSprocStatusEnum").FAILURE:d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1}});F({messageType:c("PAKEMessageTypeEnum").DECRYPTION_ERROR,sessionId:g});break}},function(a){d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},string:{exceptionMessage:a}}),F({messageType:c("PAKEMessageTypeEnum").DECRYPTION_ERROR,sessionId:g})})})},H=function(a){var b=a.annotations,e=a.fbLoggerMessage,f=a.messageType,g=a.onFinish;a=a.unsubFromTable;v();a();g();e!=null&&c("FBLogger")("labyrinth_web").mustfix(e,f);d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,b)},I=function(a){var b=a.onPakeStepOneSuccess;u=C.subscribe(function(a,f){if(f.operation!=="put"&&f.operation!=="add")return;a=f.value;f=(h||(h=d("I64"))).to_int32(a.messageType);switch(f){case c("PAKEMessageTypeEnum").PAKE_MESSAGE_1:c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_SEND_PAKE_MESSAGE_ONE_END");u();b();break;case c("PAKEMessageTypeEnum").INVALID_PREVIOUS_MESSAGE_ERROR:case c("PAKEMessageTypeEnum").PREVIOUS_MESSAGE_MISSING_ERROR:return H({annotations:{bool:{isUserError:!1},"int":{errorCode:f}},fbLoggerMessage:"PAKE: Failed to send PAKE message one due to invalid state",messageType:f,onFinish:function(){return e()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").MESSAGE_SENT_ERROR:return H({annotations:{bool:{isUserError:!1},"int":{errorCode:f}},fbLoggerMessage:"PAKE: Failed to send PAKE message one",messageType:f,onFinish:function(){return e()},unsubFromTable:function(){u()}});default:break}})},J=function(a){var b=a.sessionId;u=C.subscribe(function(a,g){if(g.operation!=="put"&&g.operation!=="add")return;a=g.value;g=(h||(h=d("I64"))).to_int32(a.messageType);switch(g){case c("PAKEMessageTypeEnum").PAKE_MESSAGE_2_AND_SECRET:u();G({messagePayload:a.messagePayload,responderId:a.responderId,sessionId:b});break;case c("PAKEMessageTypeEnum").MAX_ATTEMPTS_ERROR:return H({annotations:{bool:{isUserError:!0},"int":{errorCode:g}},messageType:g,onFinish:function(){return f()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").SESSION_EXPIRED_ERROR:return H({annotations:{bool:{isUserError:!0},"int":{errorCode:g}},messageType:g,onFinish:function(){return n()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").GENERIC_ERROR:return H({annotations:{bool:{isUserError:!1},"int":{errorCode:g}},fbLoggerMessage:"PAKE: Something went wrong in the responder device",messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").FETCH_SECRETS_ERROR:return H({annotations:{bool:{isUserError:!1},"int":{errorCode:g}},fbLoggerMessage:"PAKE: Responder device failed to fetch secrets.",messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").FLOW_ABANDONED_ERROR:return H({annotations:{bool:{isUserError:!1},"int":{errorCode:g}},fbLoggerMessage:"PAKE: Responder device flow was abandoned.",messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}});default:return H({annotations:{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},fbLoggerMessage:"PAKE: Unexpected Message Type when listening for pake step two success "+g,messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}})}})},K=function(a){var f=a.onJoinSessionSuccess;c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_GET_ACTIVE_SESSION_START");j.onReady(function(a){c("promiseDone")(a.joinPakeSession({clientType:b,initiatorId:w,storage:s}),function(a){var b=a[0],i=a[1];a=a[2];i=(i=i)!=null?i:k;switch((h||(h=d("I64"))).to_int32(b)){case c("PAKEGetActiveSessionSprocStatusEnum").SUCCESS:if(a==null||i===k){c("FBLogger")("labyrinth_web").mustfix("PAKE: When joining session, responderId or joinedSessionId were unexpectedly null");d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}});e();return}f(a,i);c("QPLUserFlow").addAnnotations(d("MWPakeQPLEvents").pakeInitiatorQplEvent,{string:{session_id:(h||(h=d("I64"))).to_string(i)}});break;case c("PAKEGetActiveSessionSprocStatusEnum").NO_SESSION:if(B===!1){E();return}d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!0},"int":{errorCode:c("PAKEMessageTypeEnum").NO_ACTIVE_SESSION}});g();v();break;case c("PAKEGetActiveSessionSprocStatusEnum").FAILURE:d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}});c("FBLogger")("labyrinth_web").mustfix("PAKE: When joining session, sproc failed");e();v();break}},function(){d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}}),c("FBLogger")("labyrinth_web").mustfix("PAKE: When joining session, sproc failed"),e(),v()})})},L=function(a){var e=a.responderId,f=a.sessionId,g;c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_CPACE_STEP_ONE_START");try{g=x.clientBegin(y,q,e)}catch(a){F({messageType:c("PAKEMessageTypeEnum").CPACE_STEP_1_ERROR,sessionId:f});d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").CPACE_STEP_1_ERROR}});throw c("FBLogger")("labyrinth_web").mustfixThrow("PAKE: Error executing CPace step 1")}c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_SEND_MESSAGE_ONE_START");j.onReady(function(a){a.sendPakeMessageOne({clientType:b,initiatorId:w,messagePayload:d("PakeCpaceUtils").typedArrayToBuffer(g),sessionId:f,storage:s})});I({onPakeStepOneSuccess:function(){J({sessionId:f})}})},M=function(){D();d("PakeQplLogging").startPakeQPLFlow(d("MWPakeQPLEvents").pakeInitiatorQplEvent);K({onJoinSessionSuccess:function(a,b){L({responderId:a,sessionId:b})}});return{pakeClient:y,stopTimeout:v,unsubFromMessagesTable:u}};return M()});return n.apply(this,arguments)}g["default"]=a}),98);